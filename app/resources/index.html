<!DOCTYPE html>
<head>
    <link rel="stylesheet" href="/style.css">
    <meta charset="UTF-8" />
    <title>Aim Trainer</title>
</head>

<body>
    <h1>Aim Trainer</h1>
    <button onclick="training()">Start</button>
    <info id="time_left" style="right: 2.5%;">30.0</info>
    <info id="points" style="right: 17.5%;">0</info>

    <trainer><p></p></trainer>

    <script>

        let button = document.querySelector("button");

        async function training() {

            button.disabled = true;

            let trainer = document.querySelector("trainer");
            let time_left_node = document.getElementById("time_left")
            let startTime = Date.now();

            let target_list = [];

            function countdown() {
                const elapsedTime = Date.now() - startTime;

                if (elapsedTime < 3000){
                    trainer.querySelector("p").innerHTML = ((3000 - elapsedTime) / 1000).toFixed(0);
                }

                if (elapsedTime >= 3000) {
                    trainer.querySelector("p").innerHTML = null;
                }
                
                if (elapsedTime > 3000){
                    time_left_node.innerHTML = ((33000 - elapsedTime) / 1000).toFixed(1);
                    target = document.createElement("target")
                    target_list.push(target)
                    trainer.appendChild(target)
                }

                if (elapsedTime >= 33000) {
                    clearInterval(countdown_id);
                    for(let i = 0; i < target_list.length; i++){
                        target_list[i].remove()
                    }
                    time_left_node.innerHTML = "Done!";
                }
            }

            countdown_id = setInterval(countdown, 100);
            return await new Promise(res => {setTimeout(() => {button.disabled = false; for(i in target_list){delete i;}}, 33000);});
        }
    </script>
</body>